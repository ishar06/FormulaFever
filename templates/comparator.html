{% extends 'layout.html' %}

{% block title %}Ghost Lap Comparator - FormulaFever{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            
            <h2 class="mb-4">Ghost Lap Comparator</h2>
            <p class="text-secondary mb-4">Compare the fastest laps of two drivers from any session (Qualifying or Race).</p>

            <!-- The Form Section -->
            <div class="form-section" style="background-color: var(--bs-dark-bg-subtle); padding: 2rem; border-radius: 0.5rem; border: 1px solid var(--bs-border-color-translucent);">
                <form action="{{ url_for('compare_laps') }}" method="POST" class="race-search-form">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="year" class="form-label">Year</label>
                            <input type="number" class="form-control" id="year" name="year" value="2024" required>
                        </div>
                        <div class="col-md-6">
                            <label for="gp" class="form-label">Grand Prix (e.g., Spanish Grand Prix)</label>
                            <input type="text" class="form-control" id="gp" name="gp" value="Spanish Grand Prix" required>
                        </div>
                        <div class="col-md-4">
                            <label for="session" class="form-label">Session</label>
                            <select id="session" name="session" class="form-select">
                                <option value="Q">Qualifying (Q)</option>
                                <option value="R">Race (R)</option>
                                <option value="FP1">FP1</option>
                                <option value="FP2">FP2</option>
                                <option value="FP3">FP3</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="driver1" class="form-label">Driver 1 (e.g., VER)</label>
                            <input type="text" class="form-control" id="driver1" name="driver1" value="VER" required>
                        </div>
                        <div class="col-md-4">
                            <label for="driver2" class="form-label">Driver 2 (e.g., HAM)</label>
                            <input type="text" class="form-control" id="driver2" name="driver2" value="HAM" required>
                        </div>
                        <div class="col-md-12 d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">Compare Laps</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- The Results Section -->
            <div class="results-section mt-5">
                
                <!-- Check for a general error -->
                {% if error_message %}
                    <div class="alert alert-danger" role="alert">
                        <strong>Error:</strong> {{ error_message }}
                    </div>
                {% endif %}

                <!-- Check for the delta plot -->
                {% if delta_plot %}
                    <h3 class="mb-3">Delta Time</h3>
                    <img src="data:image/png;base64,{{ delta_plot }}" alt="Lap time delta plot" class="img-fluid rounded-3" style="border: 1px solid var(--bs-border-color-translucent); background-color: #0d1117;">
                {% endif %}
                
                <!-- Check for the telemetry plot -->
                {% if telemetry_plot %}
                    <h3 class="mt-5 mb-3">Telemetry Comparison</h3>
                    <img src="data:image/png;base64,{{ telemetry_plot }}" alt="Telemetry comparison plot" class="img-fluid rounded-3" style="border: 1px solid var(--bs-border-color-translucent); background-color: #0d1117;">
                {% endif %}
            </div>

        </div>
    </div>
</div>
{% endblock %}